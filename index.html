<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Flashcards</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            text-align: center;
        }
        
        h1 {
            margin-bottom: 20px;
            font-size: 1.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .toggle-container {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .toggle-label {
            font-size: 0.45rem;
            font-weight: 500;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .toggle-switch.active {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(25px);
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4);
            margin: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(238, 90, 36, 0.6);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        #viewAnswerBtn {
            background: linear-gradient(45deg, #4834d4, #667eea);
            box-shadow: 0 4px 15px rgba(72, 52, 212, 0.4);
        }
        
        #viewAnswerBtn:hover {
            box-shadow: 0 6px 20px rgba(72, 52, 212, 0.6);
        }
        
        /* Difficulty buttons styling */
        .difficulty-buttons {
            display: none;
            margin-top: 20px;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .difficulty-btn {
            flex: 1;
            min-width: 90px;
            max-width: 150px;
            padding: 12px 16px;
            font-size: 0.9rem;
            margin: 5px;
            border-radius: 25px;
            font-weight: 600;
        }
        
        .btn-hard {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }
        
        .btn-hard:hover {
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.6);
        }
        
        .btn-medium {
            background: linear-gradient(45deg, #ffa502, #ff8c00);
            box-shadow: 0 4px 15px rgba(255, 165, 2, 0.4);
        }
        
        .btn-medium:hover {
            box-shadow: 0 6px 20px rgba(255, 165, 2, 0.6);
        }
        
        .btn-easy {
            background: linear-gradient(45deg, #2ed573, #27ae60);
            box-shadow: 0 4px 15px rgba(46, 213, 115, 0.4);
        }
        
        .btn-easy:hover {
            box-shadow: 0 6px 20px rgba(46, 213, 115, 0.6);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .word-pair {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .english, .german {
            flex: 1;
            min-width: 200px;
        }
        
        .english {
            text-align: left;
        }
        
        .german {
            text-align: right;
        }
        
        .hidden-answer {
            opacity: 0.3;
            filter: blur(8px);
            user-select: none;
            pointer-events: none;
        }
        
        .revealed-answer {
            opacity: 1;
            filter: blur(0px);
            transition: all 0.5s ease;
        }
        
        .language-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .word {
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .arrow {
            font-size: 2rem;
            opacity: 0.6;
        }
        
        .error {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 480px) {
            .word-pair {
                flex-direction: column;
            }
            
            .english, .german {
                text-align: center;
            }
            
            .arrow {
                transform: rotate(90deg);
            }
            
            .word {
                font-size: 1.5rem;
            }
            
            .main-buttons button {
                flex: 1;
                min-width: 120px;
            }
            
            .header-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .difficulty-buttons {
                flex-direction: row;
                justify-content: space-between;
            }
            
            .difficulty-btn {
                flex: 1;
                min-width: 80px;
                font-size: 0.8rem;
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🇩🇪 German Flashcards</h1>
        
        <div class="toggle-container">
            <div class="toggle-label">EN → DE</div>
            <div class="toggle-switch" id="languageToggle" onclick="toggleLanguageOrder()">
                <div class="toggle-slider"></div>
            </div>
            <div class="toggle-label">DE → EN</div>
        </div>
        
        <button id="getWordBtn" onclick="getRandomWord()">
            Get Word
        </button>
        
        <button id="viewAnswerBtn" onclick="showAnswer()" style="display: none;">
            Answer
        </button>
        
        <div id="result"></div>
        
        <!-- Difficulty buttons - shown after answer is revealed -->
        <div class="difficulty-buttons" id="difficultyButtons">
            <button class="difficulty-btn btn-hard" onclick="setDifficulty('hard')">
                Hard<br><small>(20 min)</small>
            </button>
            <button class="difficulty-btn btn-medium" onclick="setDifficulty('medium')">
                Medium<br><small>(2 hours)</small>
            </button>
            <button class="difficulty-btn btn-easy" onclick="setDifficulty('easy')">
                Easy<br><small>(24 hours)</small>
            </button>
        </div>
    </div>

    <script>
        let currentEnglishWord = '';
        let currentGermanWord = '';
        let currentCardId = null;
        let answerRevealed = false;
        let showGermanFirst = false; // false = English first, true = German first
        let cardBatch = []; // Store fetched cards
        let currentCardIndex = 0;
        
        const API_BASE_URL = 'https://german-card-site-api.onrender.com';

        function toggleLanguageOrder() {
            const toggle = document.getElementById('languageToggle');
            showGermanFirst = !showGermanFirst;
            
            if (showGermanFirst) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
            
            // If there's already a word displayed, update the display
            if (currentEnglishWord && currentGermanWord) {
                displayWordPair(currentEnglishWord, currentGermanWord);
            }
        }

        function displayWordPair(english, german, cardId) {
            const resultDiv = document.getElementById('result');
            const viewAnswerBtn = document.getElementById('viewAnswerBtn');
            const difficultyButtons = document.getElementById('difficultyButtons');
            
            answerRevealed = false;
            currentCardId = cardId;
            viewAnswerBtn.style.display = 'inline-block';
            difficultyButtons.style.display = 'none';
            
            if (showGermanFirst) {
                // Show German first, hide English
                resultDiv.innerHTML = `
                    <div class="card">
                        <div class="word-pair">
                            <div class="german">
                                <div class="language-label">Deutsch</div>
                                <div class="word">${german}</div>
                            </div>
                            <div class="arrow">→</div>
                            <div class="english hidden-answer">
                                <div class="language-label">English</div>
                                <div class="word">???</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Show English first, hide German (original behavior)
                resultDiv.innerHTML = `
                    <div class="card">
                        <div class="word-pair">
                            <div class="english">
                                <div class="language-label">English</div>
                                <div class="word">${english}</div>
                            </div>
                            <div class="arrow">→</div>
                            <div class="german hidden-answer">
                                <div class="language-label">Deutsch</div>
                                <div class="word">???</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        async function fetchNewBatch() {
            try {
                const response = await fetch(`${API_BASE_URL}/batch?size=50`);
                const data = await response.json();
                
                if (data.cards && data.cards.length > 0) {
                    cardBatch = data.cards;
                    currentCardIndex = 0;
                    return true;
                } else {
                    throw new Error('No cards received from API');
                }
            } catch (error) {
                console.error('Error fetching batch:', error);
                return false;
            }
        }

        async function getRandomWord() {
            const getWordBtn = document.getElementById('getWordBtn');
            const viewAnswerBtn = document.getElementById('viewAnswerBtn');
            const resultDiv = document.getElementById('result');
            const difficultyButtons = document.getElementById('difficultyButtons');
            
            // Reset state
            answerRevealed = false;
            viewAnswerBtn.style.display = 'none';
            difficultyButtons.style.display = 'none';
            
            // Show loading state
            getWordBtn.disabled = true;
            getWordBtn.innerHTML = '<span class="loading"></span> Loading...';
            resultDiv.innerHTML = '';
            
            try {
                // Check if we need to fetch a new batch
                if (cardBatch.length === 0 || currentCardIndex >= cardBatch.length) {
                    const batchFetched = await fetchNewBatch();
                    if (!batchFetched) {
                        resultDiv.innerHTML = `<div class="error">❌ Failed to fetch cards. Please check if the API is running.</div>`;
                        return;
                    }
                }
                
                // Get current card from batch
                const currentCard = cardBatch[currentCardIndex];
                currentEnglishWord = currentCard.english;
                currentGermanWord = currentCard.german;
                
                // Move to next card for next time
                currentCardIndex++;
                
                displayWordPair(currentEnglishWord, currentGermanWord, currentCard.id);
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `<div class="error">❌ Failed to get word. Please check if the API is running.</div>`;
            } finally {
                // Reset button
                getWordBtn.disabled = false;
                getWordBtn.innerHTML = 'Get Word';
            }
        }

        function showAnswer() {
            if (!answerRevealed && currentEnglishWord && currentGermanWord) {
                if (showGermanFirst) {
                    // Reveal English answer
                    const englishDiv = document.querySelector('.english');
                    const englishWordDiv = document.querySelector('.english .word');
                    
                    englishWordDiv.textContent = currentEnglishWord;
                    englishDiv.classList.remove('hidden-answer');
                    englishDiv.classList.add('revealed-answer');
                } else {
                    // Reveal German answer (original behavior)
                    const germanDiv = document.querySelector('.german');
                    const germanWordDiv = document.querySelector('.german .word');
                    
                    germanWordDiv.textContent = currentGermanWord;
                    germanDiv.classList.remove('hidden-answer');
                    germanDiv.classList.add('revealed-answer');
                }
                
                // Hide the "View Answer" button and show difficulty buttons
                const viewAnswerBtn = document.getElementById('viewAnswerBtn');
                const difficultyButtons = document.getElementById('difficultyButtons');
                
                viewAnswerBtn.style.display = 'none';
                difficultyButtons.style.display = 'flex';
                
                answerRevealed = true;
            }
        }
        
        async function setDifficulty(difficulty) {
            if (!currentCardId) {
                console.error('No current card ID');
                return;
            }
            
            try {
                // Disable difficulty buttons during API call
                const buttons = document.querySelectorAll('.difficulty-btn');
                buttons.forEach(btn => btn.disabled = true);
                
                const response = await fetch(`${API_BASE_URL}/cards/${currentCardId}/difficulty/${difficulty}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log(`Card marked as ${difficulty}:`, result);
                    // Re-enable buttons before getting next card
                    buttons.forEach(btn => btn.disabled = false);
                    // Automatically show next card
                    await getRandomWord();
                } else {
                    throw new Error(`API returned ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error setting difficulty:', error);
                
                // Re-enable buttons on error
                const buttons = document.querySelectorAll('.difficulty-btn');
                buttons.forEach(btn => btn.disabled = false);
                
                // Show error message
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML += `<div class="error">❌ Failed to save difficulty. Please try again.</div>`;
            }
        }
    </script>
</body>
</html>